<div class="tool-container">
    <h2>üé® Tool Chuy·ªÉn Skin -> 3D Schematic</h2>
    <p>Ch·ªçn file Skin Minecraft c·ªßa b·∫°n (ƒë·ªãnh d·∫°ng .png) ƒë·ªÉ chuy·ªÉn ƒë·ªïi th√†nh file .schem d√πng cho WorldEdit.</p>
    
    <div class="upload-area">
        <input type="file" id="skinInput" accept="image/png" />
    </div>

    <button id="convertBtn" onclick="convertSkin()">Chuy·ªÉn ƒê·ªïi Ngay üöÄ</button>

    <p id="statusMessage"></p>
</div>

<style>
    .tool-container {
        background-color: #1e1e2e;
        color: #cdd6f4;
        max-width: 500px;
        margin: 40px auto;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        text-align: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        border: 1px solid #313244;
    }
    .tool-container h2 {
        color: #89b4fa;
        margin-top: 0;
    }
    .upload-area {
        margin: 20px 0;
        padding: 20px;
        border: 2px dashed #6c7086;
        border-radius: 8px;
        background-color: #181825;
    }
    input[type="file"] {
        color: #a6adc8;
    }
    #convertBtn {
        background-color: #a6e3a1;
        color: #11111b;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
    }
    #convertBtn:hover {
        background-color: #94e2d5;
        transform: scale(1.02);
    }
    #convertBtn:disabled {
        background-color: #585b70;
        cursor: not-allowed;
        transform: none;
    }
    #statusMessage {
        margin-top: 15px;
        font-weight: bold;
        min-height: 20px;
    }
</style>

<script>
    async function convertSkin() {
        const fileInput = document.getElementById('skinInput');
        const statusMsg = document.getElementById('statusMessage');
        const convertBtn = document.getElementById('convertBtn');

        // Ki·ªÉm tra xem ƒë√£ ch·ªçn file ch∆∞a
        if (fileInput.files.length === 0) {
            statusMsg.textContent = '‚ö†Ô∏è Vui l√≤ng ch·ªçn m·ªôt file ·∫£nh skin (.png) tr∆∞·ªõc!';
            statusMsg.style.color = '#f38ba8'; // M√†u ƒë·ªè l·ªói
            return;
        }

        // ƒê√≥ng bƒÉng n√∫t b·∫•m & Hi·ªán tr·∫°ng th√°i loading
        convertBtn.disabled = true;
        convertBtn.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
        statusMsg.textContent = 'ƒêang t·∫£i ·∫£nh l√™n v√† ph√¢n t√≠ch m√†u s·∫Øc...';
        statusMsg.style.color = '#f9e2af'; // M√†u v√†ng ch·ªù

        // Chu·∫©n b·ªã d·ªØ li·ªáu g·ª≠i ƒëi
        const formData = new FormData();
        formData.append('skin', fileInput.files[0]);

        try {
            // G·ªçi ƒë·∫øn API tr√™n Vercel c·ªßa b·∫°n
            const response = await fetch('/api/convert', {
                method: 'POST',
                body: formData
            });

            // N·∫øu server tr·∫£ v·ªÅ l·ªói (v√≠ d·ª• kh√¥ng t√¨m th·∫•y file, l·ªói code...)
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'L·ªói t·ª´ m√°y ch·ªß!');
            }

            // L·∫•y d·ªØ li·ªáu file .schem tr·∫£ v·ªÅ d·∫°ng Blob (File nh·ªã ph√¢n)
            const blob = await response.blob();
            
            // T·∫°o link ·∫©n ƒë·ªÉ √©p tr√¨nh duy·ªát t·ª± ƒë·ªông t·∫£i file v·ªÅ
            const downloadUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = downloadUrl;
            
            // ƒê·∫∑t t√™n file khi t·∫£i xu·ªëng (C√≥ th·ªÉ l·∫•y t√™n g·ªëc c·ªßa ·∫£nh + _3D.schem)
            let originalName = fileInput.files[0].name.replace('.png', '');
            a.download = originalName + '_3D.schem';
            
            document.body.appendChild(a);
            a.click(); // K√≠ch ho·∫°t t·∫£i v·ªÅ
            a.remove(); // X√≥a th·∫ª a ƒëi cho s·∫°ch
            window.URL.revokeObjectURL(downloadUrl); // Gi·∫£i ph√≥ng b·ªô nh·ªõ

            // B√°o th√†nh c√¥ng
            statusMsg.textContent = '‚úÖ Th√†nh c√¥ng! File .schem ƒë√£ ƒë∆∞·ª£c t·∫£i v·ªÅ m√°y c·ªßa b·∫°n.';
            statusMsg.style.color = '#a6e3a1'; // M√†u xanh th√†nh c√¥ng

        } catch (error) {
            // X·ª≠ l√Ω khi c√≥ l·ªói x·∫£y ra
            statusMsg.textContent = '‚ùå Th·∫•t b·∫°i: ';
            statusMsg.style.color = '#f38ba8';
        } finally {
            // Kh√¥i ph·ª•c l·∫°i n√∫t b·∫•m sau khi ch·∫°y xong (d√π th√†nh c√¥ng hay l·ªói)
            convertBtn.disabled = false;
            convertBtn.textContent = 'Chuy·ªÉn ƒê·ªïi Ngay üöÄ';
        }
    }
</script>